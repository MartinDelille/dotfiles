#zmodload zsh/zprof

export LANG="en_US.UTF-8"
export LC_COLLATE="en_US.UTF-8"
export LC_CTYPE="en_US.UTF-8"
export LC_MESSAGES="en_US.UTF-8"
export LC_MONETARY="en_US.UTF-8"
export LC_NUMERIC="en_US.UTF-8"
export LC_TIME="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

fpath=(${HOME}/.dotfiles/functions $fpath)

# Download Znap, if it's not there yet.
[[ -f ~/dev/clone/zsh-snap/znap.zsh ]] ||
    git clone --depth 1 -- \
        https://github.com/marlonrichert/zsh-snap.git ~/dev/clone/zsh-snap

source ~/dev/clone/zsh-snap/znap.zsh  # Start Znap

znap source martindelille/ohmyzsh \
  lib/git.zsh \
  lib/prompt_info_functions.zsh \
  lib/theme-and-appearance.zsh

znap prompt martindelille/ohmyzsh crunch

znap source martindelille/ohmyzsh \
  plugins/osx \
  plugins/git

znap source zsh-users/zsh-syntax-highlighting
znap source zsh-users/zsh-completions
znap source zsh-users/zsh-history-substring-search

znap source kutsan/zsh-system-clipboard
znap source lukechilds/zsh-nvm

znap eval iterm2 'curl -fsSL https://iterm2.com/shell_integration/zsh'

bindkey "^[[A" history-substring-search-up
bindkey "^[[B" history-substring-search-down

#zprof

[ -f $HOME/.secret ] && source $HOME/.secret ]

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Make Ctrl+e accept autosuggestion
bindkey '^e' autosuggest-accept

zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'

export HISTSIZE=999999999
export SAVEHIST=$HISTSIZE
setopt share_history
setopt hist_ignore_all_dups
setopt hist_ignore_space
setopt autocd
# Ruby / rbenv
export PATH="$HOME/.rbenv/bin:$PATH"
eval "$(rbenv init -)"

# Python / pyenv
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init --path)"

eval "$(pyenv init -)"

# Make sure to restart your entire logon session
# for changes to profile files to take effect.

# fshow - git commit browser
# source: https://junegunn.kr/2015/03/browsing-git-commits-with-fzf
fshow() {
  local out sha q
  while out=$(
      git log --graph --color=always \
          --format="%C(auto)%h%d %s %C(black)%C(bold)%cr" "$@" |
      fzf --ansi --multi --no-sort --reverse --query="$q" --print-query); do
    q=$(head -1 <<< "$out")
    while read sha; do
      git show --color=always $sha | less -R
    done < <(sed '1d;s/^[^a-z0-9]*//;/^$/d' <<< "$out" | awk '{print $1}')
  done
}
